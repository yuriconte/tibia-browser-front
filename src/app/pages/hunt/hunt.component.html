<p-toast key="tst" [style]="{'white-space': 'pre-line'}"></p-toast>
<p-messages [value]="msgs"></p-messages>
<div class="grid">
  <div class="col-12 md:col-12 pb-0">
    
    <p-panel header="Vida / Mana" [toggleable]="true">
      <div class="grid">
        <div class="col-8 md:col-4 lg:col-4 health-bar pb-0">
          <p-progressBar [value]="character.life/character.maxLife*100" [showValue]="false" styleClass="mb-1"></p-progressBar>
        </div>
        <div class="col-4 md:col-2 lg:col-2 pb-0" style="font-size: 1.3rem; padding-right: 0;">
          {{character.life}} / {{character.maxLife}}
        </div>
        <div class="col-8 md:col-4 lg:col-4 mana-bar pb-0">
          <p-progressBar [value]="character.mana/character.maxMana*100" [showValue]="false"></p-progressBar>
        </div>
        <div class="col-4 md:col-2 lg:col-2 pb-0" style="font-size: 1.3rem; padding-right: 0;">
          {{character.mana}} / {{character.maxMana}}
        </div>
      </div>
    </p-panel>
  </div>
  <div class="col-12 md:col-12 pb-0">
    <p-panel header="Equipamentos" [toggleable]="true">
      <div class="grid">
        <div class="col-4 md:col-4 lg:col-2 pb-0">
          <p-chip label="Club" image="assets/gifs/items/Club.gif" styleClass="m-1 w-full" pTooltip="Atk: 7<br>Def: 7" [escape]="false" ></p-chip>
        </div>
        <div class="col-4 md:col-4 lg:col-2 pb-0">
          <p-chip label="Coat" image="assets/gifs/items/Coat.gif" styleClass="m-1 w-full" pTooltip="Arm: 1" [escape]="false" ></p-chip>
        </div>
      </div>
    </p-panel>
  </div>
  <div class="col-12 md:col-12 pb-0">
    <p-panel header="Skills / Experiência - Level {{character.level}}" [toggleable]="true">
      <div class="grid">
        <div class="col-6 md:col-4 lg:col-4 xl:col-2 pb-0">
          <p-button label="Sword" badge="{{character.sword}}" styleClass="w-full p-button-secondary"></p-button>
        </div>
        <div class="col-6 md:col-4 lg:col-4 xl:col-2 pb-0">
          <p-button label="Axe" badge="{{character.axe}}" styleClass="w-full p-button-secondary"></p-button>
        </div>
        <div class="col-6 md:col-4 lg:col-4 xl:col-2 pb-0">
          <p-button label="Club" badge="{{character.club}}" styleClass="w-full p-button-secondary"></p-button>
        </div>
        <div class="col-6 md:col-4 lg:col-4 xl:col-2 pb-0">
          <p-button label="Distance" badge="{{character.distance}}" styleClass="w-full p-button-secondary"></p-button>
        </div>
        <div class="col-6 md:col-4 lg:col-4 xl:col-2 pb-0">
          <p-button label="Shielding" badge="{{character.shielding}}" styleClass="w-full p-button-secondary"></p-button>
        </div>
        <div class="col-6 md:col-4 lg:col-4 xl:col-2 pb-0">
          <p-button label="Magic" badge="{{character.magicLevel}}" styleClass="w-full p-button-secondary"></p-button>
        </div>
        <div class="col-8 md:col-8 lg:col-10 exp-bar pb-0">
          <p-progressBar [value]="character.experience/expNextLevel*100" [showValue]="false"></p-progressBar>
        </div>
        <div class="col-4 md:col-4 lg:col-2 pb-0" style="font-size: 1.3rem; padding-right: 0;">
          {{character.experience}} / {{expNextLevel}}
        </div>
      </div>
    </p-panel>
  </div>
	<div class="col-12 md:col-12 pb-5">
		<div class="card" *ngIf="!statusHunt">
      <h5>Caçar</h5>
      <div class="grid">
        <div class="col-12 md:col-12">
          <p-dropdown 
            [options]="creatures" 
            optionLabel="name" 
            [(ngModel)]="selectedCreature"
            placeholder="Selecione a criatura"
            styleClass="w-full"
            id="creature">
            <ng-template pTemplate="selectedItem">
              <div class="flex align-items-center gap-2" *ngIf="selectedCreature">
                <p-tag severity="{{selectedCreature.creature.tagType}}" value="{{selectedCreature.creature.tagLabel}}" [rounded]="true"></p-tag>
                <p-tag severity="info" value="{{selectedCreature.creature.expHour}} exp/h" *ngIf="selectedCreature.creature.expHour"></p-tag>
                <img src="assets/gifs/creatures/{{selectedCreature.creature.imagePath}}" alt="{{selectedCreature.creature.name}}" width="32" height="32"/>
                <div>{{ selectedCreature.creature.name }}</div>
              </div>
            </ng-template>
            <ng-template let-creature pTemplate="item">
                <div class="flex align-items-center gap-2">
                  <p-tag severity="{{creature.creature.tagType}}" value="{{creature.creature.tagLabel}}" [rounded]="true"></p-tag>
                  <p-tag severity="info" value="{{creature.creature.expHour}} exp/h" *ngIf="creature.creature.expHour"></p-tag>
                  <img src="assets/gifs/creatures/{{creature.creature.imagePath}}" alt="{{creature.creature.name}}" width="32" height="32"/>
                  <div>{{ creature.creature.name }}</div>
                </div>
            </ng-template>
          </p-dropdown>
        </div>
        <div class="col-12 md:col-12">
          <label for="usePotions" class="block text-900 text-xl font-medium mb-2">Usar Potions? (WIP)</label>
          <p-toggleButton id="usePotions" onLabel="Sim" offLabel="Não" [style]="{'width': '10em'}" [disabled]="true" styleClass="w-full"></p-toggleButton>
        </div>
        <div class="col-12 md:col-12">
          <label for="huntStyle" class="block text-900 text-xl font-medium mb-2">Estilo</label>
          <p-selectButton id="huntStyle" [options]="huntStyle" [(ngModel)]="huntStyleSelected" optionLabel="name"></p-selectButton>
        </div>
        <!-- <div class="col-12 md:col-12">
          <label for="timeLeft" class="block text-900 text-xl font-medium mb-2">Progresso</label>
          <p-progressBar [value]="37" id="timeLeft">
            <ng-template pTemplate="content" let-value> 
              <span>01:59</span>    
            </ng-template>
          </p-progressBar>
        </div> -->
        <div class="col-12 md:col-12 pb-0">
          <label for="huntUntil" class="block text-900 text-xl font-medium mb-2">Parar com quanto de vida?</label>
          <p-inputNumber 
            mode="decimal" 
            [showButtons]="true" 
            [min]="0" 
            [max]="185" 
            [step]="10"
            [(ngModel)]="minLife"
            buttonLayout="vertical" 
            spinnerMode="vertical" 
            decrementButtonClass="p-button-secondary"
            incrementButtonClass="p-button-secondary" 
            incrementButtonIcon="pi pi-plus" 
            decrementButtonIcon="pi pi-minus">
            </p-inputNumber>
        </div>
        <div class="col-12 md:col-12 pb-0">
          <button label="Iniciar" pButton pRipple (click)="startHunt(character)" class="w-full" [disabled]="!selectedCreature"></button>
        </div>
      </div>
    </div>
    <div class="card" *ngIf="statusHunt">
      <h5>Caçando</h5>
      <div class="grid">
        <div class="col-12 md:col-12">
          <div class="card mb-0">
            <div class="flex justify-content-between mb-3">
                <div>
                    <span class="block text-500 font-medium mb-3">Matou</span>
                    <div class="text-900 font-medium text-xl">{{countMonsterKill}}</div>
                </div>
                <div class="flex align-items-center justify-content-center border-round" [ngStyle]="{width: '2.5rem', height: '2.5rem'}">
                  <img src="assets/gifs/creatures/{{selectedCreature.creature.imagePath}}" alt="{{selectedCreature.name}}" width="64" height="64"/>
                </div>
            </div>
            <span class="text-green-500 font-medium">{{totalExpEarned}} </span>
            <span class="text-500">EXP ganha</span>
            <span class="text-green-500 font-medium pl-5">{{avgExpHour}} </span>
            <span class="text-500">EXP/h</span>
            <span class="text-green-500 font-medium pl-5">{{totalGoldEarned}} </span>
            <span class="text-500"><img src="assets/gifs/items/Gold_Coin.gif" width="32" height="32"/></span>
        </div>
        </div>
        <div class="col-12 md:col-12 pb-0">
          <button label="Cancelar" pButton pRipple class="w-full p-button-danger" (click)="cancelHunt()"></button>
        </div>
      </div>
    </div>
  </div>
</div>