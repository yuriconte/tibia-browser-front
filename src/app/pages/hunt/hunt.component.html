<p-toast key="tst" [style]="{'white-space': 'pre-line'}"></p-toast>
<p-messages [value]="msgs"></p-messages>
<div class="grid">
  <div class="col-12 md:col-12 pb-0 pl-0 pr-0">
    <p-panel header="Vida / Mana" [toggleable]="true">
      <div class="grid">
        <div class="col-12 md:col-12 lg:col-12 health-bar pb-0">
          <div class="progress-container">
            <p-progressBar [value]="character.life/character.maxLife*100" [showValue]="false"></p-progressBar>
            <div class="progress-text">{{character.life}} / {{character.maxLife}}</div>
          </div>
        </div>
        <div class="col-12 md:col-12 lg:col-12 mana-bar pb-0">
          <div class="progress-container">
            <p-progressBar [value]="character.mana/character.maxMana*100" [showValue]="false"></p-progressBar>
            <div class="progress-text">{{character.mana}} / {{character.maxMana}}</div>
          </div>
        </div>
        <div class="col-12 md:col-12 lg:col-12 exp-bar pb-0">
          <div class="progress-container">
            <p-progressBar [value]="(character.experience-expPreviousLevel)/(expNextLevel-expPreviousLevel)*100" [showValue]="false"></p-progressBar>
            <div class="progress-text">Level {{character.level}} - Exp {{character.experience}} / {{expNextLevel}}</div>
          </div>
        </div>
      </div>
    </p-panel>
  </div>
  <div class="col-12 md:col-12 pb-0 pl-0 pr-0">
    <p-panel header="Equipamentos" [toggleable]="true" [collapsed]="true">
      <div class="grid">
        <div class="col-4 md:col-4 lg:col-2 pb-0" *ngIf="character.slot1Item">
          <p-chip label="{{character.slot1Item.name}}" image="assets/gifs/items/{{character.slot1Item.imagePath}}" styleClass="m-1 w-full" ></p-chip>
        </div>
        <div class="col-4 md:col-4 lg:col-2 pb-0" *ngIf="character.slot2Item">
          <p-chip label="{{character.slot2Item.name}}" image="assets/gifs/items/{{character.slot2Item.imagePath}}" styleClass="m-1 w-full" ></p-chip>
        </div>
        <div class="col-4 md:col-4 lg:col-2 pb-0" *ngIf="character.slot3Item">
          <p-chip label="{{character.slot3Item.name}}" image="assets/gifs/items/{{character.slot3Item.imagePath}}" styleClass="m-1 w-full" ></p-chip>
        </div>
        <div class="col-4 md:col-4 lg:col-2 pb-0" *ngIf="character.slot4Item">
          <p-chip label="{{character.slot4Item.name}}" image="assets/gifs/items/{{character.slot4Item.imagePath}}" styleClass="m-1 w-full" ></p-chip>
        </div>
        <div class="col-4 md:col-4 lg:col-2 pb-0" *ngIf="character.slot5Item">
          <p-chip label="{{character.slot5Item.name}}" image="assets/gifs/items/{{character.slot5Item.imagePath}}" styleClass="m-1 w-full" ></p-chip>
        </div>
        <div class="col-4 md:col-4 lg:col-2 pb-0" *ngIf="character.slot6Item">
          <p-chip label="{{character.slot6Item.name}}" image="assets/gifs/items/{{character.slot6Item.imagePath}}" styleClass="m-1 w-full" ></p-chip>
        </div>
      </div>
    </p-panel>
  </div>
  <div class="col-12 md:col-12 pb-0 pl-0 pr-0">
    <p-panel header="Skills / Experiência" [toggleable]="true" [collapsed]="true">
      <div class="grid">
        <div class="col-6 md:col-4 lg:col-4 xl:col-2 pb-0">
          <p-button label="Sword" badge="{{character.sword}}" styleClass="w-full p-button-secondary"></p-button>
        </div>
        <div class="col-6 md:col-4 lg:col-4 xl:col-2 pb-0">
          <p-button label="Axe" badge="{{character.axe}}" styleClass="w-full p-button-secondary"></p-button>
        </div>
        <div class="col-6 md:col-4 lg:col-4 xl:col-2 pb-0">
          <p-button label="Club" badge="{{character.club}}" styleClass="w-full p-button-secondary"></p-button>
        </div>
        <div class="col-6 md:col-4 lg:col-4 xl:col-2 pb-0">
          <p-button label="Distance" badge="{{character.distance}}" styleClass="w-full p-button-secondary"></p-button>
        </div>
        <div class="col-6 md:col-4 lg:col-4 xl:col-2 pb-0">
          <p-button label="Shielding" badge="{{character.shielding}}" styleClass="w-full p-button-secondary"></p-button>
        </div>
        <div class="col-6 md:col-4 lg:col-4 xl:col-2 pb-0">
          <p-button label="Magic" badge="{{character.magicLevel}}" styleClass="w-full p-button-secondary"></p-button>
        </div>
      </div>
    </p-panel>
  </div>
	<div class="col-12 md:col-12 pb-5 pl-0 pr-0">
		<div class="card" *ngIf="!statusHunt">
      <h5>Caçar</h5>
      <div class="grid">
        <div class="col-12 md:col-12">
          <p-dropdown 
            [options]="creatures" 
            optionLabel="name" 
            [(ngModel)]="selectedCreature"
            placeholder="Selecione a criatura"
            styleClass="w-full"
            id="creature">
            <ng-template pTemplate="selectedItem">
              <div class="flex align-items-center gap-2" *ngIf="selectedCreature">
                <p-tag severity="{{selectedCreature.creature.tagType}}" value="{{selectedCreature.creature.tagLabel}}" [rounded]="true"></p-tag>
                <p-tag severity="info" value="{{selectedCreature.creature.expHour}} exp/h" *ngIf="selectedCreature.creature.expHour"></p-tag>
                <img src="assets/gifs/creatures/{{selectedCreature.creature.imagePath}}" alt="{{selectedCreature.creature.name}}" width="32" height="32"/>
                <div>{{ selectedCreature.creature.name }}</div>
              </div>
            </ng-template>
            <ng-template let-creature pTemplate="item">
                <div class="flex align-items-center gap-2">
                  <p-tag severity="{{creature.creature.tagType}}" value="{{creature.creature.tagLabel}}" [rounded]="true"></p-tag>
                  <p-tag severity="info" value="{{creature.creature.expHour}} exp/h" *ngIf="creature.creature.expHour"></p-tag>
                  <img src="assets/gifs/creatures/{{creature.creature.imagePath}}" alt="{{creature.creature.name}}" width="32" height="32"/>
                  <div>{{ creature.creature.name }}</div>
                </div>
            </ng-template>
          </p-dropdown>
        </div>
        <div class="col-12 md:col-12" *ngIf="selectedCreature?.creature?.items?.length > 0">
          <p-panel header="Loot" [toggleable]="true" [collapsed]="true">
            <p-table [value]="selectedCreature.creature.items">
              <ng-template pTemplate="header">
                <tr>
                  <th>Item</th>
                  <th>Raridade</th>
                  <th>Valor</th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-item>
                <tr>
                  <td>
                    <img src="assets/gifs/items/{{item.item.imagePath}}" width="30">
                  </td>
                  <td>
                    <p-tag severity="primary" value="Comum" *ngIf="item.rate === 'comum'"></p-tag>
                    <p-tag severity="info" value="Incomum" *ngIf="item.rate === 'incomum'"></p-tag>
                    <p-tag severity="warning" value="Raro" *ngIf="item.rate === 'raro'"></p-tag>
                    <p-tag severity="danger" value="Ultra" *ngIf="item.rate === 'ultra'"></p-tag>
                  </td>
                  <td>
                    <span class="image-text ml-2">{{item.item.gold}}</span>
                    <img src="assets/gifs/items/Gold_Coin.gif" width="30" style="vertical-align: middle"/>
                  </td>
                </tr>
              </ng-template>
            </p-table>
          </p-panel>
        </div>
        <div class="col-12 md:col-12">
          <label for="usePotions" class="block text-900 text-xl font-medium mb-2">Usar Potions? (WIP)</label>
          <p-toggleButton id="usePotions" onLabel="Sim" offLabel="Não" [style]="{'width': '10em'}" [disabled]="true" styleClass="w-full"></p-toggleButton>
        </div>
        <div class="col-12 md:col-12 pb-0" *ngIf="spells?.length > 0">
          <label for="useSpellHealingBtn" class="block text-900 text-xl font-medium mb-2">Usar Magica de Cura?</label>
          <p-toggleButton id="useSpellHealingBtn" onLabel="Sim" offLabel="Não" [style]="{'width': '10em'}" [(ngModel)]="useSpellHealing" styleClass="w-full"></p-toggleButton>
        </div>
        <div class="col-12 md:col-12 pb-0" *ngIf="spells?.length > 0">
          <p-dropdown 
            *ngIf="useSpellHealing"
            [options]="spells" 
            optionLabel="name" 
            [(ngModel)]="selectedSpell"
            placeholder="Selecione a magia"
            styleClass="w-full"
            id="useSpellHealingDropDown">
            <ng-template pTemplate="selectedItem">
              <div class="flex align-items-center gap-2" *ngIf="selectedSpell">
                <img src="assets/gifs/spells/{{selectedSpell.imagePath}}" alt="{{selectedSpell.spell}}" width="32" height="32"/>
                <div>"{{ selectedSpell.spell }}" - Mana: {{selectedSpell.manaRequired}}</div>
              </div>
            </ng-template>
            <ng-template let-spell pTemplate="item">
                <div class="flex align-items-center gap-2">
                  <img src="assets/gifs/spells/{{spell.imagePath}}" alt="{{spell.spell}}" width="32" height="32"/>
                  <div>"{{ spell.spell }}" - Mana: {{spell.manaRequired}}</div>
                </div>
            </ng-template>
          </p-dropdown>
        </div>
        <div class="col-12 md:col-12" *ngIf="spells?.length > 0">
          <label for="spellUntil" class="block text-900 text-xl font-medium mb-2">Usar com quanto de vida?</label>
          <div>
            <input type="text" pInputText [(ngModel)]="lifeToUseSpell" class="w-full mb-3" readonly id="spellUntil"/>
            <p-slider id="slid1" [(ngModel)]="lifeToUseSpell" class="w-full" [min]="10" [max]="character.maxLife"/>
          </div>
        </div>
        <div class="col-12 md:col-12">
          <label for="huntStyle" class="block text-900 text-xl font-medium mb-2">Estilo</label>
          <p-selectButton id="huntStyle" [options]="huntStyle" [(ngModel)]="huntStyleSelected" optionLabel="name"></p-selectButton>
        </div>
        <div class="col-12 md:col-12 pb-0">
          <label for="huntUntil" class="block text-900 text-xl font-medium mb-2">Parar com quanto de vida?</label>
          <div>
            <input type="text" pInputText [(ngModel)]="minLife" class="w-full mb-3" readonly id="huntUntil"/>
            <p-slider id="slid2" [(ngModel)]="minLife" class="w-full" [min]="10" [max]="character.maxLife"/>
          </div>
        </div>
        <div class="col-12 md:col-12 pb-0">
          <button label="Iniciar" pButton pRipple (click)="startHunt(character)" class="w-full" [disabled]="!selectedCreature"></button>
        </div>
      </div>
    </div>
    <div class="card" *ngIf="statusHunt">
      <h5>Caçando</h5>
      <div class="grid">
        <div class="col-8 md:col-10 lg:col-10 health-bar pb-3">
          <p-progressBar [value]="monster.life/monster.maxLife*100" [showValue]="false" styleClass="mb-1"></p-progressBar>
        </div>
        <div class="col-4 md:col-2 lg:col-2 pb-3" style="font-size: 1.3rem; padding-right: 0;">
          {{monster.life}} / {{monster.maxLife}}
        </div>
        <div class="col-12 md:col-12">
          <div class="card mb-0">
            <div class="flex justify-content-between mb-3">
                <div>
                    <span class="block text-500 font-medium mb-3">Matou</span>
                    <div class="text-900 font-medium text-xl">{{countMonsterKill}}</div>
                </div>
                <div class="flex align-items-center justify-content-center border-round" [ngStyle]="{width: '2.5rem', height: '2.5rem'}">
                  <img src="assets/gifs/creatures/{{selectedCreature.creature.imagePath}}" alt="{{selectedCreature.name}}" width="64" height="64"/>
                </div>
            </div>
            <span class="text-green-500 font-medium">{{totalExpEarned}} </span>
            <span class="text-500">Exp</span>
            <span class="text-green-500 font-medium pl-3">{{avgExpHour}} </span>
            <span class="text-500">Exp/h</span>
            <span class="text-green-500 font-medium pl-3">{{totalGoldEarned}} </span>
            <span class="text-500"><img src="assets/gifs/items/Gold_Coin.gif" width="32" height="32" style="vertical-align: middle"/></span>
          </div>
        </div>
        <div class="col-12 md:col-12" *ngIf="lootDrop?.length > 0">
          <p-panel header="Loot" [toggleable]="true">
            <p-table [value]="lootDrop">
              <ng-template pTemplate="header">
                <tr>
                  <th>Item</th>
                  <th>Quantidade</th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-item>
                <tr>
                  <td>
                    <img src="assets/gifs/items/{{item.item.imagePath}}" width="30">
                  </td>
                  <td>
                    <span class="image-text ml-2">{{item.quantity}}</span>
                  </td>
                </tr>
              </ng-template>
            </p-table>
          </p-panel>
        </div>
        <div class="col-12 md:col-12 pb-0">
          <button label="Cancelar" pButton pRipple class="w-full p-button-danger" (click)="cancelHunt()"></button>
        </div>
      </div>
    </div>
  </div>
</div>